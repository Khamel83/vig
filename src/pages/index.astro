---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Home">
  <div class="space-y-8">
    <section class="text-center py-12">
      <h1 class="text-4xl font-bold mb-4">The Vig</h1>
      <p class="text-xl text-slate-400 max-w-2xl mx-auto">
        Simple prediction pools for friends. Pick your teams, track the leaderboard,
        and see who takes home the pot.
      </p>
    </section>

    <section>
      <h2 class="text-2xl font-bold mb-6">Active Pools</h2>
      <div id="events-grid" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        <p class="text-slate-400">Loading events...</p>
      </div>
    </section>
  </div>
</Layout>

<script>
  async function loadEvents() {
    const grid = document.getElementById('events-grid') as HTMLDivElement;

    try {
      const response = await fetch('/api/events?status=open');
      const data = await response.json();

      // Also get active events
      const activeResponse = await fetch('/api/events?status=active');
      const activeData = await activeResponse.json();

      const allEvents = [...data.events, ...activeData.events];

      if (allEvents.length === 0) {
        grid.innerHTML = '<p class="text-slate-400 col-span-full">No active pools right now. Check back soon!</p>';
        return;
      }

      grid.innerHTML = allEvents.map((event: any) => `
        <a href="/${event.slug}" class="card hover:border-vig-500 border border-transparent transition-colors">
          <div class="flex items-center gap-2 mb-2">
            <span class="px-2 py-1 text-xs font-medium bg-slate-700 rounded">${event.sport || 'Pool'}</span>
            <span class="px-2 py-1 text-xs font-medium rounded ${
              event.status === 'open' ? 'bg-vig-600' :
              event.status === 'active' ? 'bg-blue-600' : 'bg-slate-600'
            }">
              ${event.status}
            </span>
          </div>
          <h3 class="text-xl font-semibold mb-2">${event.name}</h3>
          <p class="text-slate-400">${event.description || 'Join the pool!'}</p>
        </a>
      `).join('');
    } catch (error) {
      grid.innerHTML = '<p class="text-red-400">Failed to load events</p>';
    }
  }

  loadEvents();
</script>
